<h1>Admin::Weeks#index</h1>

<h3><%= @admin %>さんがログイン中</h3>

<hr>
<div id="setting-visible">
  <%= render "admin/settings/switch", setting: @setting %>
</div>
<hr>

<h3>新規作成</h3>
<%= form_with model: @week, url: weeks_path do |f| %>
  <div class="mb-3">
    <%= f.label :monday, "週の初めの日付を選択" %><br>
    <%= f.date_field :monday, class: "form-control" %>
  </div>
  <div class="mb-3">
    <%= f.submit "作成", class: "btn btn-primary" %>
  </div>
<% end %>

<%= link_to "過去のシフト", admin_weeks_past_path %>

<h3>日程一覧</h3>
<% @weeks.each do |week| %>
  <%= link_to admin_week_jobs_path(week_id: week.id) do %>
    <%= (week.monday).month %>月<%= (week.monday).day %>日～<%= (week.sunday).month %>月<%= (week.sunday).day %>日<br>
  <% end %>
<% end %>


<h3><span id="calendar-title"><%= @start_date.strftime('%-m月') %></span></h3>
<div id="calendar-container" data-controller="calendar" data-earliest-date="<%= @earliest_date.to_date %>" class="calendar-grid box theme-dark">
  <div class="calendar-grid header public-calendar">
    <div class="week-day">月</div>
    <div class="week-day">火</div>
    <div class="week-day">水</div>
    <div class="week-day">木</div>
    <div class="week-day">金</div>
    <div class="week-day text-primary">土</div>
    <div class="week-day text-danger">日</div>
  </div>
  <!-- カレンダー本体 -->
  <div class="calendar-grid body">
    <% @calendar_rows.each do |date, week| %>
        <% if week %>
        <div class="week-row public-calendar">
          <%= link_to admin_week_jobs_path(week_id: week.id), class:"week-link" do %>
            <% [:monday, :tuesday, :wednesday, :thursday, :friday, :saturday, :sunday].each do |day| %>
              <% d = week.send(day).to_date %>
              <div class=
                "date 
                <%= holiday_class(d) %>
                <%= d.month.odd? ? 'odd-month' : 'even-month' %> 
                <%= 'today' if d == @today %>"
                data-month="<%= d.month %>"
                data-date="<%= d %>"
              >
                <span class="date-label"><%= d.day %></span>
              </div>
            <% end %>
          <% end %>
        </div>
        <% elsif date.monday <= Date.today + 7 %>
        <div class="week-row-3 public-calendar">
          <% (0..6).each do |day| %>
            <% d = (date + day).to_date %>
            <div class=
              "date 
              <%= holiday_class(d) %> 
              <%= d.month.odd? ? 'odd-month' : 'even-month' %> 
              <%= 'today' if d == @today %> "
              data-month="<%= d.month %>" 
              data-date="<%= d %>"
            >
              <span class="date-label">
                <% if d.month == @start_date.month %>
                  <%= d.day %>
                <% else %>
                  <%= "#{d.month}/#{d.day}" %>
                <% end %>
              </span>
            </div>
          <% end %>
        </div>
        <% else %>
        <div class="week-row-2 public-calendar">
          <% (0..6).each do |day| %>
            <% d = (date + day).to_date %>
            <div class=
              "date 
              <%= holiday_class(d) %> 
              <%= d.month.odd? ? 'odd-month' : 'even-month' %> 
              <%= 'today' if d == @today %> "
              data-month="<%= d.month %>" 
              data-date="<%= d %>"
            >
              <span class="date-label">
                <% if d.month == @start_date.month %>
                  <%= d.day %>
                <% else %>
                  <%= "#{d.month}/#{d.day}" %>
                <% end %>
              </span>
            </div>
          <% end %>
        </div>
        <% end %>
    <% end %>
  </div>
</div>
